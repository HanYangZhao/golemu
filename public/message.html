<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title> WebSockets </title>
		<style>
			* {
				padding: 0px;
				margin: 0px;
			}
			body {
				width:100%;
				font-family: fantasy;
				font-size: 13px;
			}
			h1 {
				text-align: center;
			}
			#text {
				position: relative;
				left: 500px;
				top: 20px;
			}
			#chat-box-container {
				width: 600px;
				height: 100%;
				position: relative;
				left: 500px;
				top: 50px;
			}
			#chatbox {
				position: relative;
				right: 150px;
				border-style: solid;
				border-radius: 2px;
				padding: 10px;
			}
		</style>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script>
			try {
				var sock = new WebSocket("ws://"+window.location.host+"/ws");
				//sock.binaryType = 'blob'; // can set it to 'blob' or 'arraybuffer
				console.log("Websocket - status: " + sock.readyState);
				sock.onopen = function(m) {
					console.log("CONNECTION opened..." + this.readyState);}
				sock.onmessage = function(m) {
					$('#chatbox').append('<p>' + m.data + '</p>');
                    console.log(m.data)}
				sock.onerror = function(m) {
					console.log("Error occured sending..." + m.data);}
				sock.onclose = function(m) {
					console.log("Disconnected - status " + this.readyState);}
			} catch(exception) {
				console.log(exception);
			}
		</script>
	</head>
	<body>
		<h1> This chat is powered by web sockets </h1>
		<div id ="text">
		<textarea id="textin" cols="30" rows="4" placeholder="This is where you type..." autofocus>
		</textarea>
		<button id="send">Send Message</button>
		<button id="add-tag">add</button>
		<button id="delete-tag">delete</button>
		<button id="retrieve-tag">retrieve</button>
		</div>

		<div id="chat-box-container">
			<h2> This is the chatbox... </h2>
			<div id="chatbox">
				<p> Go Type stuff... </p>
			</div>
		</div>

		<script>
			$('#textin').val("");
			// take what's the textbox and send it off
			$('#send').click( function(event) {
				sock.send($('#textin').val());
				$('#textin').val("");
			});
			$('#add-tag').click( function(event) {
                var add_tag = {
	                "updateType": "add",
                  "tag": {
		                "pcBits": "29a9",
		                "length": "16",
		                "epcLengthBits": "80",
		                "epc": "dc20420c4c72cf4d76de",
		                "readData": "1f1f"
                  }
                };
				sock.send(JSON.stringify(add_tag));
            });
			$('#delete-tag').click( function(event) {
                var delete_tag = {
	                "updateType": "delete",
                  "tag": {
		                "pcBits": "29a9",
		                "length": "16",
		                "epcLengthBits": "80",
		                "epc": "dc20420c4c72cf4d76de",
		                "readData": "1f1f"
                  }
                };
				sock.send(JSON.stringify(delete_tag));
            });
			$('#retrieve-tag').click( function(event) {
                var retrieve_tag = {
	                "updateType": "retrieve",
                  "tag": {
		                "pcBits": "",
		                "length": "",
		                "epcLengthBits": "",
		                "epc": "",
		                "readData": ""
                  }
                };
				sock.send(JSON.stringify(retrieve_tag));
            });

		</script>
	</body>
</html>

